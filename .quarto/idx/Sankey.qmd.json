{"title":"Sankey Diagrams","markdown":{"yaml":{"title":"Sankey Diagrams","format":"html"},"headingText":"Static Sankeys","containsRefs":false,"markdown":"\n\n\nYou can create a static sankey diagram with an extension of ggplot2, the ggsankey diagram. Be sure to install new packages as we use them!\n\nHere I create an example dataset designed to demonstrate the structure of the data used in sankey diagrams. The structure of the input data is key: each row represents an individual unit (in our example, a person) and the variables represent the stages or groupings that we want to connect. The make_long() function helps reshape the data into the special long format required by ggsankey.\n\n```{r}\nlibrary(ggsankey)\nlibrary(ggplot2)\n\n\ndf <- data.frame(\n  person = 1:6,\n  department = c(\"HR\", \"HR\", \"IT\", \"IT\", \"Finance\", \"Finance\"),\n  role = c(\"Manager\", \"Analyst\", \"Engineer\", \"Manager\", \"Analyst\", \"Manager\")\n)\n\ndf_long <- df %>%\n  make_long(department, role)\n```\n\nThe ggplot code is then built almost exactly like any other ggplot—by mapping aesthetics (x, node, next_node, etc.) and layering geoms (geom_sankey() for the flows and geom_sankey_label() for the node labels).\n\n```{r}\nggplot(df_long, aes(x = x,\n                    next_x = next_x,\n                    node = node,\n                    next_node = next_node,\n                    fill = node,\n                    label = node)) +\n  geom_sankey(flow.alpha = 0.6, node.color = \"gray30\") +\n  geom_sankey_label(size = 3, color = \"white\") +\n  theme_sankey(base_size = 16) +\n  labs(title = \"Departments connected to roles\", x = \"\", fill = \"Node\")\n\n```\n\nTo summarize, static Sankey diagrams are a powerful way to represent how individuals, resources, or events \"flow\" between categories.\n\nStatic Sankey diagrams are especially useful when:\n\n-   You want to highlight categorical transitions (e.g., departments → roles, courses → majors, or stages in a process).\n\n-   The dataset is not too large or complex, so that the flows remain legible.\n\n-   You need a clean, publication-ready plot that integrates well with other ggplot2 visualizations.\n\nIn the next section, we’ll look at interactive Sankey diagrams, which allow users to hover, highlight, and explore more complex flows dynamically.\n\n## Dynamic Sankeys\n\n```{r}\nlibrary(networkD3)\nlibrary(tidyverse)\n```\n\nWhile static Sankey diagrams are great for clear, publication-ready visuals, sometimes it’s useful to let your audience *explore* the flows interactively. The networkD3 package provides a way to build dynamic Sankey diagrams directly in R that you can click, drag, and hover over to reveal more detail.\n\nIn the example below, we extend our dataset by adding a third dimension: **location**. Now, instead of just seeing how departments map to roles, we can also track how those roles are distributed across locations (NY or SF).\n\nAfter preparing the nodes (unique categories across all stages) and links (pairs of connected categories with values that represent their flow), we can pass them into `sankeyNetwork()`.\n\n```{r}\n\ndf <- data.frame(\n  person = 1:6,\n  department = c(\"HR\", \"HR\", \"IT\", \"IT\", \"Finance\", \"Finance\"),\n  role = c(\"Manager\", \"Analyst\", \"Engineer\", \"Manager\", \"Analyst\", \"Manager\"),\n  location = c(\"NY\", \"NY\", \"SF\", \"NY\", \"SF\", \"SF\")\n)\n\n\nall_nodes <- unique(c(df$department, df$role, df$location))\nnodes <- data.frame(name = all_nodes)\n\n\nlinks_1 <- df %>%\n  group_by(department, role) %>%\n  summarise(value = n(), .groups = \"drop\") %>%\n  mutate(\n    source = match(department, nodes$name) - 1,\n    target = match(role, nodes$name) - 1\n  ) %>%\n  select(source, target, value)\n\n\nlinks_2 <- df %>%\n  group_by(role, location) %>%\n  summarise(value = n(), .groups = \"drop\") %>%\n  mutate(\n    source = match(role, nodes$name) - 1,\n    target = match(location, nodes$name) - 1\n  ) %>%\n  select(source, target, value)\n\n\nlinks <- bind_rows(links_1, links_2)\n\nsankeyNetwork(\n  Links = links,\n  Nodes = nodes,\n  Source = \"source\",\n  Target = \"target\",\n  Value = \"value\",\n  NodeID = \"name\",\n  fontSize = 12,\n  nodeWidth = 30\n)\n\n```\n\nThe resulting diagram has several advantages over a static plot:\n\n-   Interactivity: You can hover over flows to highlight connections and see the underlying values\n\n-   Drag-and-drop nodes: Rearrange nodes to explore different layouts and better understand relationships.\n\n-   Scalability: Dynamic Sankeys handle more complex networks that would be difficult to interpret in a static image.\n\nThis makes networkd3 particularly useful when presenting data to an audience that wants to interact with the flows, or when working with more complicated structures that go beyond a simple two-level diagram.\n","srcMarkdownNoYaml":"\n\n## Static Sankeys\n\nYou can create a static sankey diagram with an extension of ggplot2, the ggsankey diagram. Be sure to install new packages as we use them!\n\nHere I create an example dataset designed to demonstrate the structure of the data used in sankey diagrams. The structure of the input data is key: each row represents an individual unit (in our example, a person) and the variables represent the stages or groupings that we want to connect. The make_long() function helps reshape the data into the special long format required by ggsankey.\n\n```{r}\nlibrary(ggsankey)\nlibrary(ggplot2)\n\n\ndf <- data.frame(\n  person = 1:6,\n  department = c(\"HR\", \"HR\", \"IT\", \"IT\", \"Finance\", \"Finance\"),\n  role = c(\"Manager\", \"Analyst\", \"Engineer\", \"Manager\", \"Analyst\", \"Manager\")\n)\n\ndf_long <- df %>%\n  make_long(department, role)\n```\n\nThe ggplot code is then built almost exactly like any other ggplot—by mapping aesthetics (x, node, next_node, etc.) and layering geoms (geom_sankey() for the flows and geom_sankey_label() for the node labels).\n\n```{r}\nggplot(df_long, aes(x = x,\n                    next_x = next_x,\n                    node = node,\n                    next_node = next_node,\n                    fill = node,\n                    label = node)) +\n  geom_sankey(flow.alpha = 0.6, node.color = \"gray30\") +\n  geom_sankey_label(size = 3, color = \"white\") +\n  theme_sankey(base_size = 16) +\n  labs(title = \"Departments connected to roles\", x = \"\", fill = \"Node\")\n\n```\n\nTo summarize, static Sankey diagrams are a powerful way to represent how individuals, resources, or events \"flow\" between categories.\n\nStatic Sankey diagrams are especially useful when:\n\n-   You want to highlight categorical transitions (e.g., departments → roles, courses → majors, or stages in a process).\n\n-   The dataset is not too large or complex, so that the flows remain legible.\n\n-   You need a clean, publication-ready plot that integrates well with other ggplot2 visualizations.\n\nIn the next section, we’ll look at interactive Sankey diagrams, which allow users to hover, highlight, and explore more complex flows dynamically.\n\n## Dynamic Sankeys\n\n```{r}\nlibrary(networkD3)\nlibrary(tidyverse)\n```\n\nWhile static Sankey diagrams are great for clear, publication-ready visuals, sometimes it’s useful to let your audience *explore* the flows interactively. The networkD3 package provides a way to build dynamic Sankey diagrams directly in R that you can click, drag, and hover over to reveal more detail.\n\nIn the example below, we extend our dataset by adding a third dimension: **location**. Now, instead of just seeing how departments map to roles, we can also track how those roles are distributed across locations (NY or SF).\n\nAfter preparing the nodes (unique categories across all stages) and links (pairs of connected categories with values that represent their flow), we can pass them into `sankeyNetwork()`.\n\n```{r}\n\ndf <- data.frame(\n  person = 1:6,\n  department = c(\"HR\", \"HR\", \"IT\", \"IT\", \"Finance\", \"Finance\"),\n  role = c(\"Manager\", \"Analyst\", \"Engineer\", \"Manager\", \"Analyst\", \"Manager\"),\n  location = c(\"NY\", \"NY\", \"SF\", \"NY\", \"SF\", \"SF\")\n)\n\n\nall_nodes <- unique(c(df$department, df$role, df$location))\nnodes <- data.frame(name = all_nodes)\n\n\nlinks_1 <- df %>%\n  group_by(department, role) %>%\n  summarise(value = n(), .groups = \"drop\") %>%\n  mutate(\n    source = match(department, nodes$name) - 1,\n    target = match(role, nodes$name) - 1\n  ) %>%\n  select(source, target, value)\n\n\nlinks_2 <- df %>%\n  group_by(role, location) %>%\n  summarise(value = n(), .groups = \"drop\") %>%\n  mutate(\n    source = match(role, nodes$name) - 1,\n    target = match(location, nodes$name) - 1\n  ) %>%\n  select(source, target, value)\n\n\nlinks <- bind_rows(links_1, links_2)\n\nsankeyNetwork(\n  Links = links,\n  Nodes = nodes,\n  Source = \"source\",\n  Target = \"target\",\n  Value = \"value\",\n  NodeID = \"name\",\n  fontSize = 12,\n  nodeWidth = 30\n)\n\n```\n\nThe resulting diagram has several advantages over a static plot:\n\n-   Interactivity: You can hover over flows to highlight connections and see the underlying values\n\n-   Drag-and-drop nodes: Rearrange nodes to explore different layouts and better understand relationships.\n\n-   Scalability: Dynamic Sankeys handle more complex networks that would be difficult to interpret in a static image.\n\nThis makes networkd3 particularly useful when presenting data to an audience that wants to interact with the flows, or when working with more complicated structures that go beyond a simple two-level diagram.\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","output-file":"Sankey.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.7.32","bibliography":["references.bib"],"editor":"visual","theme":["simplex","brand"],"title":"Sankey Diagrams"},"extensions":{"book":{"multiFile":true}}},"pdf":{"identifier":{"display-name":"PDF","target-format":"pdf","base-format":"pdf"},"execute":{"fig-width":5.5,"fig-height":3.5,"fig-format":"pdf","fig-dpi":300,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"pdf","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":true,"merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"pdf-engine":"xelatex","standalone":true,"variables":{"graphics":true,"tables":true},"default-image-extension":"pdf","to":"pdf","output-file":"Sankey.pdf"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"block-headings":true,"bibliography":["references.bib"],"editor":"visual","documentclass":"scrreprt","title":"Sankey Diagrams"},"extensions":{"book":{"selfContainedOutput":true}}}},"projectFormats":["html","pdf"]}